{"version":3,"sources":["../../../../../src/modules/apis/game/offer/offer.service.ts"],"sourcesContent":["// NestJS\r\nimport { Injectable, Logger } from '@nestjs/common';\r\n\r\n// Services\r\nimport { GamesPricingService } from '@repositories/sql/games-pricing/games-pricing.service';\r\nimport { GamesService } from '@repositories/sql/games/games.service';\r\n\r\n// Types\r\nimport type { Game } from '@repositories/sql/games/game.entity';\r\n\r\n@Injectable()\r\nexport class OfferService {\r\n  constructor(\r\n    private readonly logger: Logger,\r\n    private readonly game: GamesService,\r\n    private readonly pricing: GamesPricingService,\r\n  ) {}\r\n\r\n  /**\r\n   * Create a new offer\r\n   * @param data - The data of the offer to be created\r\n   * @returns A message indicating that the offer was created\r\n   */\r\n  public async createOffer(data: {\r\n    gameId: number;\r\n    discountPrice: string;\r\n    discountStartDate: Date;\r\n    discountEndDate: Date;\r\n    offerType: 'SPECIAL PROMOTION' | 'WEEKEND DEAL';\r\n  }): Promise<{ message: string }> {\r\n    const { gameId, discountPrice, discountStartDate, discountEndDate, offerType } = data;\r\n    this.logger.log(`Creating offer for game with ID ${gameId}`);\r\n\r\n    // Update the game's pricing to include the offer\r\n    await this.pricing.update(gameId, {\r\n      free: false,\r\n      discount: true,\r\n      discountPrice,\r\n      discountStartDate,\r\n      discountEndDate,\r\n      offerType,\r\n    });\r\n\r\n    // Return a success message\r\n    return { message: 'Offer created successfully' };\r\n  }\r\n\r\n  /**\r\n   * Get paginated offers\r\n   * @param page - The current page number\r\n   * @param limit - The number of items per page\r\n   * @param orderBy - The column to order by\r\n   * @param order - The order direction\r\n   * @param searchQuery - The search query\r\n   * @returns An object containing the paginated offers and the total number of offers\r\n   */\r\n  public async getOffersPaginated(\r\n    page: number,\r\n    limit: number,\r\n    orderBy:\r\n      | 'id'\r\n      | 'name'\r\n      | 'discountPrice'\r\n      | 'basePrice'\r\n      | 'discountPercentage'\r\n      | 'offerType'\r\n      | 'discountStartDate'\r\n      | 'discountEndDate',\r\n    order: 'ASC' | 'DESC',\r\n    searchQuery: { name?: string },\r\n    admin: boolean,\r\n  ): Promise<{ items: Game[]; total: number; totalPages: number }> {\r\n    this.logger.log(\r\n      `Retrieving offers, page: ${page}, limit: ${limit}, order by: ${orderBy}, order: ${order}, search query: ${JSON.stringify(searchQuery)}`,\r\n    );\r\n\r\n    // Get features paginated and return them if they exist\r\n    return await this.game.getGamesPaginated(page, limit, orderBy, order, true, searchQuery, admin);\r\n  }\r\n\r\n  /**\r\n   * Updates an offer\r\n   * @param data - The data of the offer to be updated\r\n   * @returns A message indicating that the offer was updated\r\n   */\r\n  public async updateOffer(data: {\r\n    id: number;\r\n    discountPrice?: string;\r\n    discountStartDate?: Date;\r\n    discountEndDate?: Date;\r\n    offerType?: 'SPECIAL PROMOTION' | 'WEEKEND DEAL';\r\n  }): Promise<{ message: string }> {\r\n    const { id, discountPrice, discountStartDate, discountEndDate, offerType } = data;\r\n    this.logger.log(`Updating offer with ID ${id}`);\r\n\r\n    // Update the game's pricing to include the new offer details\r\n    await this.pricing.update(id, { free: false, discountPrice, discountStartDate, discountEndDate, offerType });\r\n\r\n    // Return a success message\r\n    return { message: 'Offer updated successfully' };\r\n  }\r\n\r\n  /**\r\n   * Delete offer by game ID\r\n   * @param id The ID of the offer\r\n   * @returns A message indicating the success of the operation\r\n   */\r\n  public async delete(id: number): Promise<{ message: string }> {\r\n    this.logger.log(`Deleting offer with ID: ${id}`);\r\n\r\n    // Update the game's pricing to remove the offer\r\n    await this.pricing.update(id, {\r\n      discount: false,\r\n      discountPrice: null,\r\n      discountStartDate: null,\r\n      discountEndDate: null,\r\n      offerType: null,\r\n    });\r\n\r\n    // Return a success message\r\n    return { message: 'Offer deleted successfully' };\r\n  }\r\n}\r\n"],"names":["OfferService","constructor","logger","game","pricing","createOffer","data","gameId","discountPrice","discountStartDate","discountEndDate","offerType","log","update","free","discount","message","getOffersPaginated","page","limit","orderBy","order","searchQuery","admin","JSON","stringify","getGamesPaginated","updateOffer","id","delete"],"mappings":"AAAA,SAAS;;;;;+BAWIA;;;eAAAA;;;wBAVsB;qCAGC;8BACP;;;;;;;;;;AAMtB,IAAA,AAAMA,eAAN,MAAMA;IACXC,YACE,AAAiBC,MAAc,EAC/B,AAAiBC,IAAkB,EACnC,AAAiBC,OAA4B,CAC7C;aAHiBF,SAAAA;aACAC,OAAAA;aACAC,UAAAA;IAChB;IAEH;;;;GAIC,GACD,MAAaC,YAAYC,IAMxB,EAAgC;QAC/B,MAAM,EAAEC,MAAM,EAAEC,aAAa,EAAEC,iBAAiB,EAAEC,eAAe,EAAEC,SAAS,EAAE,GAAGL;QACjF,IAAI,CAACJ,MAAM,CAACU,GAAG,CAAC,CAAC,gCAAgC,EAAEL,QAAQ;QAE3D,iDAAiD;QACjD,MAAM,IAAI,CAACH,OAAO,CAACS,MAAM,CAACN,QAAQ;YAChCO,MAAM;YACNC,UAAU;YACVP;YACAC;YACAC;YACAC;QACF;QAEA,2BAA2B;QAC3B,OAAO;YAAEK,SAAS;QAA6B;IACjD;IAEA;;;;;;;;GAQC,GACD,MAAaC,mBACXC,IAAY,EACZC,KAAa,EACbC,OAQqB,EACrBC,KAAqB,EACrBC,WAA8B,EAC9BC,KAAc,EACiD;QAC/D,IAAI,CAACrB,MAAM,CAACU,GAAG,CACb,CAAC,yBAAyB,EAAEM,KAAK,SAAS,EAAEC,MAAM,YAAY,EAAEC,QAAQ,SAAS,EAAEC,MAAM,gBAAgB,EAAEG,KAAKC,SAAS,CAACH,cAAc;QAG1I,uDAAuD;QACvD,OAAO,MAAM,IAAI,CAACnB,IAAI,CAACuB,iBAAiB,CAACR,MAAMC,OAAOC,SAASC,OAAO,MAAMC,aAAaC;IAC3F;IAEA;;;;GAIC,GACD,MAAaI,YAAYrB,IAMxB,EAAgC;QAC/B,MAAM,EAAEsB,EAAE,EAAEpB,aAAa,EAAEC,iBAAiB,EAAEC,eAAe,EAAEC,SAAS,EAAE,GAAGL;QAC7E,IAAI,CAACJ,MAAM,CAACU,GAAG,CAAC,CAAC,uBAAuB,EAAEgB,IAAI;QAE9C,6DAA6D;QAC7D,MAAM,IAAI,CAACxB,OAAO,CAACS,MAAM,CAACe,IAAI;YAAEd,MAAM;YAAON;YAAeC;YAAmBC;YAAiBC;QAAU;QAE1G,2BAA2B;QAC3B,OAAO;YAAEK,SAAS;QAA6B;IACjD;IAEA;;;;GAIC,GACD,MAAaa,OAAOD,EAAU,EAAgC;QAC5D,IAAI,CAAC1B,MAAM,CAACU,GAAG,CAAC,CAAC,wBAAwB,EAAEgB,IAAI;QAE/C,gDAAgD;QAChD,MAAM,IAAI,CAACxB,OAAO,CAACS,MAAM,CAACe,IAAI;YAC5Bb,UAAU;YACVP,eAAe;YACfC,mBAAmB;YACnBC,iBAAiB;YACjBC,WAAW;QACb;QAEA,2BAA2B;QAC3B,OAAO;YAAEK,SAAS;QAA6B;IACjD;AACF"}