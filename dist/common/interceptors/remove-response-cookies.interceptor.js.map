{"version":3,"sources":["../../../src/common/interceptors/remove-response-cookies.interceptor.ts"],"sourcesContent":["// NestJS\r\nimport { Injectable } from '@nestjs/common';\r\n\r\n// RxJS\r\nimport { tap } from 'rxjs/operators';\r\n\r\n// Types\r\nimport type { CallHandler, ExecutionContext, NestInterceptor } from '@nestjs/common';\r\nimport type { FastifyReply } from 'fastify';\r\nimport type { Observable } from 'rxjs';\r\n\r\n/**\r\n * Interceptor to handle removing tokens from cookies\r\n * @returns Remove JWT tokens from HttpOnly cookies\r\n */\r\n@Injectable()\r\nexport class RemoveResponseCookiesInterceptor implements NestInterceptor {\r\n  public intercept(context: ExecutionContext, next: CallHandler): Observable<unknown> {\r\n    return next.handle().pipe(\r\n      tap({\r\n        next: () => {\r\n          // Get context and response\r\n          const ctx = context.switchToHttp();\r\n          const response = ctx.getResponse<FastifyReply>();\r\n\r\n          // Clear accessToken from HttpOnly cookie\r\n          response.clearCookie('accessToken', {\r\n            httpOnly: true,\r\n            secure: true,\r\n            sameSite: 'none',\r\n            path: '/',\r\n          });\r\n\r\n          // Clear refreshToken from HttpOnly cookie\r\n          response.clearCookie('refreshToken', {\r\n            httpOnly: true,\r\n            secure: true,\r\n            sameSite: 'none',\r\n            path: '/',\r\n          });\r\n        },\r\n      }),\r\n    );\r\n  }\r\n}\r\n"],"names":["RemoveResponseCookiesInterceptor","intercept","context","next","handle","pipe","tap","ctx","switchToHttp","response","getResponse","clearCookie","httpOnly","secure","sameSite","path"],"mappings":"AAAA,SAAS;;;;;+BAgBIA;;;eAAAA;;;wBAfc;2BAGP;;;;;;;AAYb,IAAA,AAAMA,mCAAN,MAAMA;IACJC,UAAUC,OAAyB,EAAEC,IAAiB,EAAuB;QAClF,OAAOA,KAAKC,MAAM,GAAGC,IAAI,CACvBC,IAAAA,cAAG,EAAC;YACFH,MAAM;gBACJ,2BAA2B;gBAC3B,MAAMI,MAAML,QAAQM,YAAY;gBAChC,MAAMC,WAAWF,IAAIG,WAAW;gBAEhC,yCAAyC;gBACzCD,SAASE,WAAW,CAAC,eAAe;oBAClCC,UAAU;oBACVC,QAAQ;oBACRC,UAAU;oBACVC,MAAM;gBACR;gBAEA,0CAA0C;gBAC1CN,SAASE,WAAW,CAAC,gBAAgB;oBACnCC,UAAU;oBACVC,QAAQ;oBACRC,UAAU;oBACVC,MAAM;gBACR;YACF;QACF;IAEJ;AACF"}